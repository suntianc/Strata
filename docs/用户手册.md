# Strata 用户手册

欢迎使用 Strata - 您的智能研究笔记和知识管理系统! 🎉

## 📖 目录

1. [快速开始](#快速开始)
2. [界面概览](#界面概览)
3. [核心功能](#核心功能)
4. [AI 配置指南](#ai-配置指南)
5. [常见使用场景](#常见使用场景)
6. [快捷键](#快捷键)
7. [常见问题](#常见问题)

---

## 🚀 快速开始

### 第一步:配置 AI 服务

Strata 需要 AI 服务来提供智能分析功能。

1. **点击右上角的设置图标** ⚙️
2. **切换到 "Models" 标签页**
3. **选择您的 LLM 提供商**:
   - **Ollama** (推荐新手,本地免费)
   - **Gemini** (云端,响应快)
   - **OpenAI** (需要付费 API Key)
   - **Custom** (自定义 API)

#### 推荐配置 - 使用 Ollama (本地免费)

```bash
# 1. 安装 Ollama
curl -fsSL https://ollama.ai/install.sh | sh

# 2. 启动服务
ollama serve

# 3. 拉取模型
ollama pull llama3.2          # 对话模型
ollama pull nomic-embed-text  # 向量化模型
```

**在 Strata 中配置**:
- Provider: `ollama`
- Model Name: `llama3.2`
- Base URL: `http://localhost:11434`
- API Key: (留空)

4. **点击 "Test Connection"** 测试连接
5. **点击 "Save Changes"** 保存配置

详细配置指南请参考: [LLM 配置指南](../LLM_CONFIG_GUIDE.md)

---

## 🎨 界面概览

Strata 界面分为三个主要区域:

```
┌──────────────┬─────────────────────┬─────────────┐
│              │                     │             │
│   侧边栏     │    消息流区域       │  右侧面板   │
│   Sidebar    │  Message Stream     │  AI Copilot │
│              │                     │             │
│  - Inbox     │  - 消息列表         │  - Info     │
│  - 项目列表  │  - 标签筛选         │  - Chat     │
│  - 搜索      │  - 新建消息         │             │
│              │                     │             │
└──────────────┴─────────────────────┴─────────────┘
```

### 1. 侧边栏 (Sidebar)

**功能**:
- 📥 **Inbox**: 未分配项目的消息
- 📁 **项目管理**: 创建和管理项目/任务层级结构
- 🔍 **搜索**: 全局搜索消息内容和标签
- 🌙 **深色模式**: 切换主题
- ⚙️ **设置**: 配置用户信息和 AI 服务

**操作**:
- 点击项目/任务查看相关消息
- 右键点击项目查看更多操作
- 拖拽项目调整顺序

### 2. 消息流区域 (Message Stream)

**功能**:
- 显示当前选中项目/任务的所有消息
- 创建、编辑、删除消息
- 添加标签和附件
- AI 智能整理

**消息卡片包含**:
- 📝 消息内容 (支持 Markdown)
- 🏷️ 标签
- 📎 附件 (PDF, Excel, 图片, 代码)
- 🕐 时间戳
- 📌 版本号

**操作**:
- 点击消息查看详情
- 点击 ✏️ 编辑消息
- 点击 🗑️ 删除消息
- 点击 📌 归档消息
- 点击标签筛选相同标签的消息

### 3. 右侧面板 (Right Panel)

**两种模式**:

#### Info 模式
显示选中消息的详细信息:
- 📋 元数据 (时间戳、标签)
- 📜 版本历史
- 🔗 相关消息 (基于向量相似度)

#### Chat 模式 (AI Copilot)
与 AI 助手对话:
- 💬 分析消息内容
- 📊 生成报告
- 🔍 回答问题
- 支持多轮对话

---

## 🎯 核心功能

### 1. 项目和任务管理

#### 创建项目

1. 在侧边栏点击 **"+ New Project"**
2. 输入项目名称 (例如: "博士论文: 神经网络架构")
3. 按 Enter 保存

#### 创建子任务

1. 选中一个项目
2. 点击 **"+ New Task"**
3. 输入任务名称 (例如: "文献综述")
4. 按 Enter 保存

#### 任务状态

每个任务都有状态指示器:
- 🟢 **Active** (进行中)
- 🔵 **Pending** (待开始)
- 🟡 **Blocked** (受阻)
- ✅ **Completed** (已完成)

右键点击任务可以更改状态。

---

### 2. 消息和笔记

#### 创建消息

**方式 1: 在消息流区域创建**
1. 选择目标项目/任务 (或 Inbox)
2. 点击 **"+ New Layer"** 按钮
3. 输入消息内容
4. 添加标签 (可选)
5. 上传附件 (可选)
6. 点击 **"Save"** 保存

**方式 2: 快捷创建**
- 按 `Ctrl+N` (或 `Cmd+N`) 快速创建新消息

#### 编辑消息

1. 点击消息卡片上的 ✏️ 编辑图标
2. 修改内容
3. 保存后会自动增加版本号

**版本控制**:
- 每次编辑都会创建新版本
- 在 Info 面板查看版本历史
- 未来可以回滚到历史版本

#### 使用标签

**为什么要用标签?**
- 🏷️ 跨项目组织内容
- 🔍 快速筛选相关消息
- 🤖 帮助 AI 理解上下文

**标签最佳实践**:
```
✅ 好的标签:
- literature (文献)
- experiment (实验)
- bug-fix (问题修复)
- meeting-notes (会议记录)

❌ 避免:
- untitled (无意义)
- misc (太笼统)
- 123 (无描述性)
```

**快速添加标签**:
1. 在消息输入框中输入 `#`
2. 输入标签名称
3. 按空格或 Enter 继续

---

### 3. AI 智能整理

#### Inbox 智能分类

当 Inbox 中有很多未分类的消息时:

1. 点击 **"🤖 AI Organize"** 按钮
2. AI 会分析所有消息内容
3. 自动建议每条消息应该归属的项目
4. 点击建议将消息移动到相应项目

**工作原理**:
- 使用向量嵌入计算消息与项目的相似度
- 基于内容、标签、历史模式进行推荐
- 学习您的使用习惯

---

### 4. AI Copilot 对话

#### 开启 Copilot

1. 点击右侧面板的 **"Copilot"** 标签
2. 或点击侧边栏的 ✨ Copilot 图标

#### 使用场景

**场景 1: 分析消息内容**
```
您: 总结这条消息的要点
AI: 根据您的消息,主要包含以下要点:
    1. 实验结果显示吞吐量提升 15%
    2. 需要验证是否由新缓存层导致
    3. 建议进行进一步的性能分析
```

**场景 2: 生成报告**
```
您: 基于最近的实验消息生成周报
AI: 本周实验进展报告:

    ## 实验概况
    - 完成 3 次性能测试
    - 识别 2 个优化点

    ## 关键发现
    ...
```

**场景 3: 回答问题**
```
您: Transformer 的注意力机制如何工作?
AI: 基于您的文献笔记 [Ref: msg-001],
    注意力机制主要通过以下步骤...
```

#### 上下文感知

- 选中消息后,AI 会自动加载该消息作为上下文
- 对话中会显示 **[Ref: xxx]** 引用标记
- 点击引用可以跳转到原消息

---

## ⚙️ AI 配置指南

### 支持的 LLM 提供商

| 提供商 | 本地/云端 | 成本 | 速度 | 推荐场景 |
|--------|----------|------|------|----------|
| **Ollama** | 本地 | 免费 | 中等 | 隐私优先、离线使用 |
| **Gemini** | 云端 | 低 | 快 | 新手、快速开始 |
| **OpenAI** | 云端 | 中-高 | 快 | 需要最佳质量 |
| **Custom** | 自定义 | 自定义 | 自定义 | 企业部署、特殊需求 |

### 配置步骤

#### 选项 1: Ollama (推荐)

**安装**:
```bash
# macOS / Linux
curl -fsSL https://ollama.ai/install.sh | sh

# Windows
# 从 https://ollama.ai/download 下载安装包
```

**启动服务**:
```bash
ollama serve
```

**拉取模型**:
```bash
# 对话模型 (二选一)
ollama pull llama3.2        # 3B,快速
ollama pull mistral         # 7B,质量更好

# 向量化模型 (必需)
ollama pull nomic-embed-text
```

**在 Strata 中配置**:
1. Settings > Models > LLM Configuration
   - Provider: `Ollama (Local)`
   - Model Name: `llama3.2`
   - Base URL: `http://localhost:11434`
   - API Key: (留空)

2. Embedding Configuration
   - Provider: `Ollama (Local)`
   - Model Name: `nomic-embed-text`
   - Base URL: `http://localhost:11434`

3. 点击 "Test Connection"
4. 看到 ✓ 成功提示后,点击 "Save Changes"

---

#### 选项 2: Google Gemini

**获取 API Key**:
1. 访问 https://aistudio.google.com/app/apikey
2. 点击 "Create API Key"
3. 复制生成的 Key (以 `AIza` 开头)

**在 Strata 中配置**:
1. Settings > Models > LLM Configuration
   - Provider: `gemini`
   - Model Name: `gemini-2.5-flash` (推荐) 或 `gemini-pro`
   - Base URL: (留空)
   - API Key: 粘贴您的 API Key

2. 点击 "Test Connection"
3. 看到 ✓ 成功提示后,点击 "Save Changes"

**费用说明**:
- Gemini 有免费额度: 每分钟 60 次请求
- Flash 模型成本低,适合频繁使用
- 详见: https://ai.google.dev/pricing

---

#### 选项 3: OpenAI

**获取 API Key**:
1. 访问 https://platform.openai.com/api-keys
2. 创建新的 API Key
3. 复制 Key (以 `sk-` 开头)

**在 Strata 中配置**:
1. Settings > Models > LLM Configuration
   - Provider: `openai`
   - Model Name: `gpt-3.5-turbo` 或 `gpt-4`
   - Base URL: (留空或 `https://api.openai.com/v1`)
   - API Key: 粘贴您的 API Key

2. 点击 "Test Connection"
3. 保存配置

**费用说明**:
- GPT-3.5-turbo: $0.50 / 1M tokens (输入)
- GPT-4: 更贵但质量最好
- 需要信用卡充值

---

#### 选项 4: 自定义 API (高级)

适用于:
- DeepSeek, 智谱 AI, 百度文心等国内 API
- 自建的 LLM 服务
- 企业内部部署

**配置步骤**:
1. Settings > Models > LLM Configuration
   - Provider: `Custom`
   - Model Name: 您的模型名称 (如 `deepseek-chat`)
   - Base URL: API 地址 (如 `https://api.deepseek.com/v1`)
   - API Key: 您的 API Key

2. 点击 "Test Connection"

**⚠️ 注意事项**:
- 自定义 API 可能有 CORS 限制
- 如果浏览器中失败,尝试使用 Electron 版本
- 详见: [故障排查指南](../TROUBLESHOOTING.md)

---

### Profile 配置

在 Settings > Profile 标签:

- **Name**: 您的姓名或昵称
- **Role / Title**: 职位或角色 (如 "研究员", "博士生")
- **Avatar URL**: 头像图片链接 (可选)

配置后会显示在界面右上角。

---

## 💡 常见使用场景

### 场景 1: 学术研究

**项目结构**:
```
📚 博士论文: 神经网络架构
  ├── 📖 文献综述
  ├── 🧪 实验 1: 基线测试
  ├── 🧪 实验 2: 优化方案
  └── ✍️ 论文写作
```

**工作流程**:
1. **阅读文献时**: 创建消息记录关键观点,添加 PDF 附件
2. **实验记录**: 每次实验创建新消息,记录参数和结果
3. **使用 AI**: 让 Copilot 总结最近的实验发现
4. **查找相关**: 在 Info 面板查看语义相关的消息

---

### 场景 2: 软件开发

**项目结构**:
```
💻 项目: Strata 开发
  ├── 🐛 Bug 修复
  ├── ✨ 新功能: AI 整理
  ├── 📝 文档更新
  └── 🚀 部署准备
```

**工作流程**:
1. **Bug 跟踪**: 每个 bug 一条消息,附加错误日志
2. **代码片段**: 保存有用的代码片段,添加 `code` 标签
3. **会议记录**: 团队讨论后创建消息总结
4. **AI 辅助**: 询问 Copilot 代码优化建议

---

### 场景 3: 个人知识管理

**项目结构**:
```
📚 读书笔记
  ├── 📖 《深度学习》
  ├── 📖 《设计模式》
  └── 📖 《项目管理》

💡 灵感收集
  ├── 💭 产品想法
  ├── 🎨 设计灵感
  └── ✍️ 写作素材
```

**工作流程**:
1. **每日记录**: 将有趣的想法记录到 Inbox
2. **定期整理**: 使用 AI Organize 自动分类
3. **主题研究**: 搜索特定标签查看相关内容
4. **AI 总结**: 让 Copilot 生成主题总结

---

## ⌨️ 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl/Cmd + N` | 新建消息 |
| `Ctrl/Cmd + F` | 聚焦搜索框 |
| `Ctrl/Cmd + S` | 保存当前编辑 |
| `Ctrl/Cmd + K` | 打开命令面板 (未来) |
| `Esc` | 关闭弹窗/取消操作 |
| `Ctrl/Cmd + ,` | 打开设置 |
| `F12` | 开发者工具 (调试用) |

---

## 🔧 常见问题

### Q1: AI 对话不工作怎么办?

**检查清单**:
- [ ] 是否在设置中配置了 LLM?
- [ ] 点击 "Test Connection" 是否成功?
- [ ] 是否点击了 "Save Changes"?
- [ ] 刷新页面后是否仍然不工作?

**解决方案**:
1. 打开设置 > Models,检查配置
2. 点击 "Test Connection" 查看详细错误
3. 参考 [LLM 配置指南](../LLM_CONFIG_GUIDE.md)
4. 参考 [故障排查指南](../TROUBLESHOOTING.md)

**快速解决**: 改用 Ollama,无 CORS 限制!

---

### Q2: 如何备份我的数据?

**浏览器版本**:
数据保存在浏览器的 LocalStorage 中。

**导出数据**:
1. 按 `F12` 打开开发者工具
2. Application > Local Storage
3. 复制 `strata_messages` 和 `strata_tasks` 的值
4. 保存到文本文件

**未来版本**: 将提供一键导出功能

**Electron 版本**:
数据保存在:
- PGlite: `~/.config/Electron/strata.db`
- LanceDB: `~/.config/Electron/lance/`
- KuzuDB: `~/.config/Electron/kuzu/`

定期备份这些目录即可。

---

### Q3: 支持哪些附件类型?

**当前支持**:
- 📄 PDF
- 📊 Excel (xlsx, csv)
- 🖼️ 图片 (jpg, png, gif)
- 💻 代码文件 (js, py, etc.)

**文件大小限制**:
- 浏览器版: 建议 < 10MB
- Electron 版: 无限制

**未来计划**:
- Word 文档
- 音频/视频
- 压缩包

---

### Q4: 如何删除演示数据?

1. 点击演示消息卡片上的 🗑️ 删除图标
2. 在侧边栏右键点击 "Demo Project"
3. 选择 "Delete Project"

**重置所有数据**:
1. 按 `F12` 打开开发者工具
2. Console 标签输入:
   ```javascript
   localStorage.clear()
   location.reload()
   ```

---

### Q5: 为什么相关消息功能不工作?

**原因**:
相关消息功能需要向量化支持。

**解决方案**:
1. 确保配置了 Embedding 模型
2. Settings > Models > Embedding Configuration
3. 推荐使用: Ollama + nomic-embed-text

**工作原理**:
- 每条消息创建时会自动向量化
- 基于语义相似度查找相关消息
- 在 Info 面板的 "Related Strata" 区域显示

---

### Q6: 支持移动端吗?

**当前状态**:
- ✅ 响应式设计已实现
- ⚠️ 移动端体验未优化
- ❌ 暂无原生 App

**建议**:
- 平板电脑: 可以使用,体验良好
- 手机: 可浏览,但编辑不便

**未来计划**:
- PWA (Progressive Web App) 支持
- iOS / Android 原生 App

---

### Q7: 如何贡献或报告问题?

**报告 Bug**:
1. 准备详细信息:
   - 操作步骤
   - 错误截图
   - 浏览器版本
   - 控制台日志 (F12)
2. 提交到项目的 Issues 页面

**功能建议**:
欢迎提出新功能建议!

**开发贡献**:
1. Fork 项目仓库
2. 创建功能分支
3. 提交 Pull Request

---

## 📚 更多资源

### 文档

- [快速启动指南](../QUICKSTART.md) - 5 分钟开始使用
- [LLM 配置指南](../LLM_CONFIG_GUIDE.md) - 详细的 AI 配置说明
- [故障排查指南](../TROUBLESHOOTING.md) - 常见问题解决方案
- [架构文档](../ARCHITECTURE_SUMMARY.md) - 技术架构说明
- [实施指南](../IMPLEMENTATION_GUIDE.md) - 开发者文档

### 外部链接

- [Ollama 官网](https://ollama.ai/)
- [Google AI Studio](https://aistudio.google.com/)
- [OpenAI Platform](https://platform.openai.com/)

---

## 🎉 开始使用

准备好了吗?

1. ✅ 配置 AI 服务 (Settings > Models)
2. ✅ 创建您的第一个项目
3. ✅ 添加一条消息
4. ✅ 尝试与 AI Copilot 对话

**祝您使用愉快!** 🚀

如果遇到问题,随时查看本手册或相关文档。

---

**版本**: 1.0.0
**更新日期**: 2025-12-11
**许可证**: MIT
